if(void 0===LP)var LP={};!function(t){var e=window.LP_Model_Quiz=Backbone.Model.extend({defaults:{},data:null,view:!1,url:function(){},urlRoot:"",questions:null,initialize:function(){this.createQuestionsList()},createQuestionsList:function(){this.questions=new s,_.each(this.get("questions"),(function(e,s){var n=new i(t.extend({quiz_id:this.get("id"),user_id:this.get("user_id")},e));n.urlRoot=this.get("ajaxurl"),n.view=this.view,this.questions.add(n)}),this)},next:function(e){if(!this.isLast()){var i=this.findNext(),s=this.questions.findWhere({id:i}),n=this;s.submit({data:{save_id:n.get("question_id"),question_answer:this.view.$("form").serializeJSON(),time_remaining:n.get("time_remaining")},complete:function(){n.set("question_id",i),t.isFunction(e)&&e.apply(n),LP.Hook.doAction("learn_press_next_question",i,n)}})}},prev:function(e){if(!this.isFirst()){var i=this.findPrev(),s=this.questions.findWhere({id:i}),n=this;s.submit({data:{save_id:n.get("question_id"),question_answer:this.view.$("form").serializeJSON(),time_remaining:n.get("time_remaining")},complete:function(){n.set("question_id",i),t.isFunction(e)&&e.apply(n),LP.Hook.doAction("learn_press_previous_question",i,n)}})}},select:function(e,i){var s=this.questions.findWhere({id:e}),n=this;s&&s.submit({data:{save_id:n.get("question_id"),question_answer:this.view.$("form").serializeJSON(),time_remaining:n.get("time_remaining")},complete:function(s){n.set("question_id",e),t.isFunction(i)&&i.apply(n,[s])}})},getQuestionPosition:function(t){return t=t||this.get("question_id"),_.indexOf(this.getIds(),t)},countQuestions:function(){return this.questions.length},isLast:function(t){return t=t||this.get("question_id"),this.getQuestionPosition(t)==this.countQuestions()-1},isFirst:function(t){return t=t||this.get("question_id"),0==this.getQuestionPosition(t)},findNext:function(t){t=t||this.get("question_id");var e=this.getIds(),i=this.getQuestionPosition(t);return void 0!==e[++i]&&e[i]},findPrev:function(t){t=t||this.get("question_id");var e=this.getIds(),i=this.getQuestionPosition(t);return void 0!==e[--i]&&e[i]},current:function(){return this.questions.findWhere({id:parseInt(this.get("question_id"))})},getIds:function(){return t.map(this.get("questions"),(function(t,e){return parseInt(t.id)}))}}),i=window.LP_Model_Question=Backbone.Model.extend({defaults:{},data:null,view:!1,url:function(){return this.urlRoot},urlRoot:"",initialize:function(){},element:function(){return t(this.get("content"))},submit:function(e){var i=this;e=t.extend({complete:null,data:{}},e||{}),this.fetch({data:t.extend({action:"learnpress_load_quiz_question",user_id:this.get("user_id"),quiz_id:this.get("quiz_id"),question_id:this.get("id")},e.data||{}),complete:function(s){var n=LP.parseJSON(s.responseText);"success"==n.result&&(i.set(n.question),n.permalink&&LP.setUrl(n.permalink),t.isFunction(e.complete)&&e.complete.call(i,n))}})},check:function(e){var i=this;e=t.isFunction(e)?{complete:e}:t.extend({complete:null,data:{}},e||{}),LP.doAjax({data:t.extend({"lp-ajax":"check-question",user_id:this.get("user_id"),quiz_id:this.get("quiz_id"),question_id:this.get("id"),save_id:this.get("id"),question_answer:t("form#learn-press-quiz-question").serializeJSON()},e.data||{}),success:function(s,n){i.set("checked",s.checked),t.isFunction(e.complete)&&e.complete.call(i,s)}})}}),s=window.LP_Collection_Questions=Backbone.Collection.extend({url:"admin-ajax.php",model:i}),n=window.LP_View_Quiz=Backbone.View.extend({model:{},events:{"click .button-start-quiz":"_startQuiz","click .button-finish-quiz":"_finishQuiz","click .button-retake-quiz":"_retakeQuiz","click .next-question":"_nextQuestion","click .prev-question":"_prevQuestion","click .check-question":"_checkQuestion","click .quiz-questions-list li a":"_selectQuestion","click .hint-question":"_hintQuestion","click .explain-question":"_explainQuestion"},el:".single-quiz",isRendered:!1,$buttons:{},initialize:function(t){this.model=t,this.model.view=this,this.listenTo(this.model,"change:question_id",this.changeQuestion),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change",this.updateCountdown),LP.Hook.addAction("learn_press_check_question",(function(t,e){e.updateAnswer.apply(e,[t])})).addAction("learn_press_update_question_content",(function(t,e,i){var s=i.model.current();setTimeout((function(){s.get("checked")&&i.updateAnswer.apply(i,[{checked:s.get("checked"),result:"success"}])}),100)})),_.bindAll(this,"render","_timeOver","_checkQuestion","_hintQuestion","updateAnswer","updateCountdown"),this._create(),this.render(),this.updateCountdown(!0)},_create:function(){if(this.$buttons={start:this.$(".button-start-quiz"),finish:this.$(".button-finish-quiz"),retake:this.$(".button-retake-quiz"),next:this.$(".next-question"),prev:this.$(".prev-question"),check:this.$(".check-question"),hint:this.$(".hint-question"),explain:this.$(".explain-question")},"started"==this.model.get("status")){this.initCountdown();var e=this.model.current();e&&(e.set({content:t("#learn-press-quiz-question .question-"+e.get("id"))}),this._updateQuestion(e.element()))}this.setButtonsState()},changeQuestion:function(){var t=this.model.current();t&&this._updateQuestion(t.element())},updateCountdown:function(t){(this.model.hasChanged("status")||t)&&"started"==this.model.get("status")&&(this.$countdown||this.initCountdown(),this.$countdown.backward_timer("start"))},render:function(){!this.model.hasChanged("question_id")&&this.model.hasChanged("status");var t=this.model.current();switch(this.setButtonsState(),this.model.get("status")){case"started":this.$(".quiz-intro").remove(),this.$(".quiz-countdown").removeClass("hide-if-js")}t&&"started"==this.model.get("status")&&(this.$('form[name="learn-press-quiz-question"]').html(t.get("content")),this.$('#learn-press-quiz-questions li[data-id="'+t.get("id")+'"]').addClass("current").siblings(".current").removeClass("current")),this.isRendered=!0,this.$el.css("visibility","visible")},setButtonsState:function(){var t="hide-if-js",e=this.model.current();switch(this.model.get("status").toLowerCase()){case"completed":this.$buttons.start.addClass(t),this.$buttons.finish.addClass(t),this.$buttons.check.addClass(t),this.$buttons.retake.removeClass(t);break;case"started":this.$buttons.start.addClass(t),this.$buttons.finish.removeClass(t),this.$buttons.retake.addClass(t),this.model.countQuestions()<=1?(this.$buttons.next.addClass(t),this.$buttons.prev.addClass(t)):(this.$buttons.next.removeClass(t),this.$buttons.prev.removeClass(t),this.model.isLast()?(this.$buttons.next.addClass(t),this.$buttons.finish.filter('[data-area="nav"]').removeClass(t)):this.$buttons.finish.filter('[data-area="nav"]').addClass(t),this.model.isFirst()&&this.$buttons.prev.addClass(t)),e&&e.get("check_answer")?this.$buttons.check.removeClass(t):this.$buttons.check.addClass(t),e&&e.get("hint")?this.$buttons.hint.removeClass(t):this.$buttons.hint.addClass(t),e&&e.get("explanation")?this.$buttons.explain.removeClass(t):this.$buttons.explain.addClass(t);break;default:this.$buttons.next.addClass(t),this.$buttons.prev.addClass(t),this.$buttons.start.removeClass(t),this.$buttons.finish.addClass(t),this.$buttons.retake.addClass(t),this.$(".quiz-questions .qq.current").removeClass("current")}},startQuiz:function(e){this.block_page(),e=t.extend({complete:!1},e||{});var i=this,s=t.extend({"lp-ajax":"start-quiz",quiz_id:this.model.get("id"),nonce:this.model.get("nonce")},e.data||{});LP.doAjax({url:window.location.href,data:s,success:function(s,n){LP.MessageBox.hide(),"success"==(s=LP.Hook.applyFilters("learn_press_start_quiz_results",s,i)).result&&(i.model.current().set(s.question),i.model.set({status:s.data.status,question_id:s.question.id}),LP.setUrl(s.question.permalink)),t.isFunction(e.complete)&&e.complete.call(i,s)}})},finishQuiz:function(e){this.pause(),this.block_page(),e=t.extend({complete:!1},e||{});var i=this,s=t.extend({"lp-ajax":"finish-quiz",quiz_id:this.model.get("id"),nonce:this.model.get("nonce")},e.data||{});LP.doAjax({data:s,success:function(s){var n=void 0;t.isFunction(e.complete)&&(n=e.complete.call(LP.Quiz,s)),LP.Hook.doAction("learn_press_finish_quiz",i.model.get("id"),i),LP.MessageBox.show(single_quiz_localize.finished_quiz,{autohide:2e3,onHide:function(){n&&n.redirect?LP.reload(n.redirect):null==n&&s.redirect&&LP.reload(s.redirect)}})}})},retakeQuiz:function(e){this.block_page(),e=t.extend({complete:!1},e||{});var i=t.extend({"lp-ajax":"retake-quiz",quiz_id:this.model.get("id"),nonce:this.model.get("nonce")},e.data||{});LP.doAjax({data:i,success:function(i,s){LP.MessageBox.hide(),"success"==i.result?(t.isFunction(e.complete)&&e.complete.call(LP.Quiz,i),LP.MessageBox.show(single_quiz_localize.retaken_quiz,{autohide:2e3,onHide:function(){LP.reload(i.redirect)}})):LP.alert(i.message)}})},updateAnswer:function(e){if(e&&"success"==e.result){var i=this.model.current(),s=t(i.get("content"));switch(i.get("type")){case"true_or_false":case"single_choice":case"multi_choice":t.each(e.checked,(function(i,n){var o=s.find('input[value="'+n.value+'"]'),a=o.closest("li").removeClass("answer-true user-answer-false");"yes"==n.is_true&&a.addClass("answer-true"),e.answered&&("string"==typeof e.answered?e.answered==n.value&&o.prop("checked",!0):-1!=t.inArray(n.value,e.answered)&&o.prop("checked",!0)),o.is(":checked")&&"yes"==n.is_true||a.addClass("user-answer-false")})),s.addClass("checked").find("input, select, textarea").prop("disabled",!0),i.set({content:s})}this.render()}},_checkQuestion:function(){if(!1!==LP.Hook.applyFilters("learn_press_before_check_question",!0,this)){var t=this;this.$buttons.next.prop("disabled",!0),this.$buttons.prev.prop("disabled",!0),this.$buttons.finish.prop("disabled",!0),this.$buttons.check.prop("disabled",!0),this.pause(),this.block_page(),this.model.current().check({complete:function(e){t.$buttons.next.prop("disabled",!1),t.$buttons.prev.prop("disabled",!1),t.$buttons.finish.prop("disabled",!1),t.$buttons.check.prop("disabled",!1),LP.Hook.doAction("learn_press_check_question",e,t),t.resume()},data:{nonce:this.model.get("nonce")}})}},_hintQuestion:function(e){e.preventDefault();var i=this.model.current();i&&i.get("hint")&&t("#learn-press-question-hint-"+i.get("id")).toggleClass("hide-if-js")},_explainQuestion:function(e){e.preventDefault();var i=this.model.current();i&&i.get("explanation")&&t("#learn-press-question-explanation-"+i.get("id")).toggleClass("hide-if-js")},_nextQuestion:function(){if(!1!==LP.Hook.applyFilters("learn_press_before_next_question",!0,this)){var t=this;this.$buttons.next.prop("disabled",!0),this.$buttons.prev.prop("disabled",!0),this.$buttons.finish.prop("disabled",!0),this.pause(),this.block_page(),this.model.next((function(){t.$buttons.next.prop("disabled",!1),t.$buttons.prev.prop("disabled",!1),t.$buttons.finish.prop("disabled",!1)}))}},_prevQuestion:function(){if(!1!==LP.Hook.applyFilters("learn_press_before_prev_question",!0,this)){var t=this;this.$buttons.next.prop("disabled",!0),this.$buttons.prev.prop("disabled",!0),this.$buttons.finish.prop("disabled",!0),this.pause(),this.block_page(),this.model.prev((function(){t.$buttons.next.prop("disabled",!1),t.$buttons.prev.prop("disabled",!1),t.$buttons.finish.prop("disabled",!1)}))}},_selectQuestion:function(e){e.preventDefault();var i=this,s=t(e.target).closest(".learn-press-question-wrap").data("id");if("started"!=this.model.get("status"))return!1;!1!==LP.Hook.applyFilters("learn_press_before_select_question",!0,i)&&(this.pause(),this.$buttons.next.prop("disabled",!0),this.$buttons.prev.prop("disabled",!0),this.$buttons.finish.prop("disabled",!0),this.pause(),this.model.select(s,(function(t){LP.Hook.doAction("learn_press_selected_question",s,i),i.$buttons.next.prop("disabled",!1),i.$buttons.prev.prop("disabled",!1),i.$buttons.finish.prop("disabled",!1)})))},_getNonce:function(t){return this.$("input#"+t+"-nonce").val()},_startQuiz:function(){var t=this;!1!==LP.Hook.applyFilters("learn_press_before_start_quiz",!0,t)&&(t.$buttons.next.prop("disabled",!0),t.$buttons.prev.prop("disabled",!0),t.$buttons.finish.prop("disabled",!0),LP.MessageBox.blockUI(),t.startQuiz({complete:function(e){LP.MessageBox.hide(),e.message?LP.alert(e.message,(function(){e.redirect&&LP.reload(e.redirect)})):e.redirect&&LP.reload(e.redirect),t.$buttons.next.prop("disabled",!1),t.$buttons.prev.prop("disabled",!1),t.$buttons.finish.prop("disabled",!1),LP.Hook.doAction("learn_press_start_quiz",e,t)}}))},_retakeQuiz:function(){var t=this;!1!==LP.Hook.applyFilters("learn_press_before_retake_quiz",!0,t)&&LP.confirm(single_quiz_localize.confirm_retake_quiz,(function(e){e&&(t.$buttons.retake.prop("disabled",!0),LP.MessageBox.blockUI(),t.retakeQuiz({complete:function(e){LP.MessageBox.hide(),LP.Hook.doAction("learn_press_user_retaken_quiz",e,t)}}))}))},_finishQuiz:function(){var t=this;!1!==LP.Hook.applyFilters("learn_press_before_finish_quiz",!0,t)&&LP.confirm(single_quiz_localize.confirm_finish_quiz,(function(e){e&&(t.$buttons.next.prop("disabled",!0),t.$buttons.prev.prop("disabled",!0),t.$buttons.finish.prop("disabled",!0),LP.MessageBox.blockUI(),t.finishQuiz({data:{save_id:t.model.get("question_id"),question_answer:t.$("form").serializeJSON(),time_remaining:t.model.get("time_remaining")},complete:function(e){LP.MessageBox.hide(),LP.Hook.doAction("learn_press_user_finished_quiz",e,t)}}))}))},_updateQuestion:function(t){var e=this.$(".quiz-question-content form"),i=e.find(".learn-press-question-wrap");i.length?i.replaceWith(t):e.append(t),LP.Hook.doAction("learn_press_update_question_content",t,i,this),LP.setUrl(t.find('input[name="learn-press-question-permalink"]').val())},initCountdown:function(){var e=this;this.$countdown||(this.$countdown=t("#quiz-countdown-value"),this.$countdown.backward_timer({seconds:parseInt(this.model.get("time_remaining")),format:e.model.get("time_format"),on_exhausted:function(t){e._timeOver(t)},on_tick:function(t){var e=t.seconds_left<=5?"#F00":"";e&&t.target.css("color",e)}}))},pause:function(){this.$countdown.backward_timer("cancel")},resume:function(){this.$countdown.backward_timer("start")},loadPage:function(t){t=t||window.location.href,window.location.href=t},_timeOver:function(t){t.target.css("color","#F00"),LP.MessageBox.blockUI(single_quiz_localize.quiz_time_is_over_message),this.finishQuiz({complete:function(t){LP.MessageBox.hide(),t.redirect&&LP.reload(t.redirect)}})},block_page:function(){},unblock_page:function(){}});LP.Quiz={init:function(t){var i=new e(t);new n(i)}},t(document).ready((function(){JSON.stringify(single_quiz_params);LP.Quiz.init(single_quiz_params)}))}(jQuery);