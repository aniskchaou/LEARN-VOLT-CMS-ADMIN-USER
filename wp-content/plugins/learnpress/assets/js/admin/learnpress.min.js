const $=jQuery,$doc=$(document),$win=$(window),makePaymentsSortable=function(){$(".learn-press-payments.sortable tbody").sortable({handle:".dashicons-menu",helper:(e,t)=>(t.children().each((function(){$(this).width($(this).width())})),t),axis:"y",start(e,t){},stop(e,t){},update(e,t){const s=$(this).children().map((function(){return $(this).find('input[name="payment-order"]').val()})).get();$.post({url:"",data:{"lp-ajax":"update-payment-order",order:s},success(e){}})}})},initTooltips=function(){$(".learn-press-tooltip").each((function(){const e=$(this),t=$.extend({title:"data-tooltip",offset:10,gravity:"s"},e.data());e.tipsy(t)}))},initSelect2=function(){$.fn.select2&&$(".lp-select-2 select").select2()},initSingleCoursePermalink=function(){$doc.on("change",'.learn-press-single-course-permalink input[type="radio"]',(function(){const e=$(this).closest(".learn-press-single-course-permalink");e.hasClass("custom-base")?e.find('input[type="text"]').prop("readonly",!1):e.siblings(".custom-base").find('input[type="text"]').prop("readonly",!0)})).on("change","input.learn-press-course-base",(function(){$("#course_permalink_structure").val($(this).val())})).on("focus","#course_permalink_structure",(function(){$("#learn_press_custom_permalink").click()})).on("change","#learn_press_courses_page_id",(function(){$("tr.learn-press-courses-page-id").toggleClass("hide-if-js",!parseInt(this.value))}))},togglePaymentStatus=function(e){e.preventDefault();const t=$(this).closest("tr"),s=($(this),t.find(".status").hasClass("enabled")?"no":"yes");$.ajax({url:"",data:{"lp-ajax":"update-payment-status",status:s,id:t.data("payment")},success(e){e=LP.parseJSON(e);for(const t in e)$("#payment-"+t+" .status").toggleClass("enabled",e[t])}})},updateEmailStatus=function(){(function(){$.post({url:window.location.href,data:{"lp-ajax":"update_email_status",status:$(this).parent().hasClass("enabled")?"no":"yes",id:$(this).data("id")},dataType:"text",success:$.proxy((function(e){e=LP.parseJSON(e);for(const t in e)$("#email-"+t+" .status").toggleClass("enabled",e[t])}),this)})}).apply(this)},toggleSalePriceSchedule=function(){return"_lp_sale_price_schedule"===$(this).attr("id")?($(this).hide(),$("#field-_lp_sale_start, #field-_lp_sale_end").removeClass("hide-if-js"),$win.trigger("resize.calculate-tab")):($("#_lp_sale_price_schedule").show(),$("#field-_lp_sale_start, #field-_lp_sale_end").addClass("hide-if-js").find("#_lp_sale_start, #_lp_sale_end").val(""),$win.trigger("resize.calculate-tab")),!1},callbackFilterTemplates=function(){const e=$(this);if(e.hasClass("current"))return!1;const t=$("#learn-press-template-files"),s=t.find("tr[data-template]"),a=e.data("template"),n=e.data("filter");return e.addClass("current").siblings("a").removeClass("current"),a?s.map((function(){$(this).toggleClass("hide-if-js",$(this).data("template")!==a)})):n?s.map((function(){$(this).toggleClass("hide-if-js","yes"!==$(this).data("filter-"+n))})):s.removeClass("hide-if-js"),$("#learn-press-no-templates").toggleClass("hide-if-js",!!t.find("tr.template-row:not(.hide-if-js):first").length),!1},toggleEmails=function(e){e.preventDefault();const t=$(this).data("status");$.ajax({url:"",data:{"lp-ajax":"update_email_status",status:t},success(e){e=LP.parseJSON(e);for(const t in e)$("#email-"+t+" .status").toggleClass("enabled",e[t])}})},importCourses=function(){const t=$("#learn-press-install-sample-data-notice"),s=$(this).attr("data-action");s&&(e.preventDefault(),"yes"===s?t.find(".install-sample-data-notice").slideUp().siblings(".install-sample-data-loading").slideDown():t.fadeOut(),$.ajax({url:ajaxurl,dataType:"html",type:"post",data:{action:"learnpress_install_sample_data",yes:s},success(e){(e=LP.parseJSON(e)).url?$.ajax({url:e.url,success(){t.find(".install-sample-data-notice").html(e.message).slideDown().siblings(".install-sample-data-loading").slideUp()}}):t.find(".install-sample-data-notice").html(e.message).slideDown().siblings(".install-sample-data-loading").slideUp()}}))},onChangeCoursePrices=function(e){const t=$(this),s=$("#_lp_price"),a=$("#_lp_sale_price"),n=$(e.target).attr("id");t.find("#field-_lp_price div, #field-_lp_sale_price div").remove(".learn-press-tip-floating"),parseInt(a.val())>=parseInt(s.val())&&("_lp_price"===n?s.parent(".rwmb-input").append('<div class="learn-press-tip-floating">'+lpAdminCourseEditorSettings.i18n.notice_price+"</div>"):"_lp_sale_price"===n&&a.parent(".rwmb-input").append('<div class="learn-press-tip-floating">'+lpAdminCourseEditorSettings.i18n.notice_sale_price+"</div>"))},onChangeSaleStartDate=function(e){const t=$(this),s=$("#_lp_sale_end"),a=Date.parse(t.val()),n=Date.parse(s.val()),i=t.parent(".rwmb-input");s.parent(".rwmb-input");a||i.append('<div class="learn-press-tip-floating">'+lpAdminCourseEditorSettings.i18n.notice_invalid_date+"</div>"),$("#field-_lp_sale_start div, #field-_lp_sale_end div").remove(".learn-press-tip-floating"),a>n&&i.append('<div class="learn-press-tip-floating">'+lpAdminCourseEditorSettings.i18n.notice_sale_start_date+"</div>")},onChangeSaleEndDate=function(e){const t=$(this),s=$("#_lp_sale_start"),a=Date.parse(s.val()),n=Date.parse(t.val()),i=(s.parent(".rwmb-input"),t.parent(".rwmb-input"));n||i.append('<div class="learn-press-tip-floating">'+lpAdminCourseEditorSettings.i18n.notice_invalid_date+"</div>"),$("#field-_lp_sale_start div, #field-_lp_sale_end div").remove(".learn-press-tip-floating"),a>n&&i.append('<div class="learn-press-tip-floating">'+lpAdminCourseEditorSettings.i18n.notice_sale_end_date+"</div>")},onReady=function(){$(".learn-press-payments.sortable tbody").sortable({handle:".dashicons-menu",helper:(e,t)=>(t.children().each((function(){$(this).width($(this).width())})),t),axis:"y",start(e,t){},stop(e,t){},update(e,t){const s=$(this).children().map((function(){return $(this).find('input[name="payment-order"]').val()})).get();$.post({url:"",data:{"lp-ajax":"update-payment-order",order:s},success(e){}})}}),$.fn.select2&&$(".lp-select-2 select").select2(),$(".learn-press-tooltip").each((function(){const e=$(this),t=$.extend({title:"data-tooltip",offset:10,gravity:"s"},e.data());e.tipsy(t)})),$doc.on("change",'.learn-press-single-course-permalink input[type="radio"]',(function(){const e=$(this).closest(".learn-press-single-course-permalink");e.hasClass("custom-base")?e.find('input[type="text"]').prop("readonly",!1):e.siblings(".custom-base").find('input[type="text"]').prop("readonly",!0)})).on("change","input.learn-press-course-base",(function(){$("#course_permalink_structure").val($(this).val())})).on("focus","#course_permalink_structure",(function(){$("#learn_press_custom_permalink").click()})).on("change","#learn_press_courses_page_id",(function(){$("tr.learn-press-courses-page-id").toggleClass("hide-if-js",!parseInt(this.value))})),$(".learn-press-tabs").LP("AdminTab"),$(document).on("click",".learn-press-payments .status .dashicons",togglePaymentStatus).on("click",".change-email-status",updateEmailStatus).on("click","#_lp_sale_price_schedule",toggleSalePriceSchedule).on("click","#_lp_sale_price_schedule_cancel",toggleSalePriceSchedule).on("click",".learn-press-filter-template",callbackFilterTemplates).on("click","#learn-press-enable-emails, #learn-press-disable-emails",toggleEmails).on("click","#learn-press-install-sample-data-notice a",importCourses).on("input","#meta-box-tab-course_payment",onChangeCoursePrices).on("change","#_lp_sale_start",onChangeSaleStartDate).on("change","#_lp_sale_end",onChangeSaleEndDate)};$(document).ready(onReady);