!function(s){var e={id:"sync-base",syncing:!1,items:!1,completed:!1,callback:null,methodGetItems:"",itemsKey:"",chunkSize:50,sync:function(s){if(!this.syncing){if(this.callback=s,!1===this.items)this.get_items();else if(!this.dispatch())return this.completed=!0,void this.callToCallback();this.syncing=!0}},init:function(){this.syncing=!1,this.items=!1,this.completed=!1},is_completed:function(){return this.completed},dispatch:function(){var e=this,t=!!this.items&&this.items.splice(0,this.chunkSize);return!(!t||0===t.length)&&(s.ajax({url:"",data:{"lp-ajax":this.id,sync:t},method:"post",success:function(s){s=LP.parseJSON(s),e.syncing=!1,"success"!==s.result&&(e.completed=!0),e.callToCallback(),e.is_completed()||e.sync(e.callback)}}),!0)},callToCallback:function(){this.callback&&this.callback.call(this)},get_items:function(){var e=this;s.ajax({url:"",data:{"lp-ajax":this.id,sync:this.methodGetItems},success:function(s){e.syncing=!1,(s=LP.parseJSON(s))[e.itemsKey]?(e.items=s[e.itemsKey],e.sync(e.callback)):(e.completed=!0,e.items=[],e.callToCallback())}})}},t=s.extend({},e,{id:"sync-course-orders",methodGetItems:"get-courses",itemsKey:"courses"}),n=s.extend({},e,{id:"sync-user-courses",methodGetItems:"get-users",itemsKey:"users",chunkSize:500}),c=s.extend({},e,{id:"sync-user-orders",methodGetItems:"get-users",itemsKey:"users",chunkSize:500}),i=s.extend({},e,{id:"sync-course-final-quiz",methodGetItems:"get-courses",itemsKey:"courses",chunkSize:500}),o=s.extend({},e,{id:"sync-remove-older-data",methodGetItems:"remove-older-data",itemsKey:"_nothing_here",chunkSize:500}),l=s.extend({},e,{id:"sync-calculate-course-results",methodGetItems:"get-users",itemsKey:"users",chunkSize:1});window.LP_Sync_Data={syncs:[],syncing:0,options:{},start:function(e){if(this.syncs=[],this.options=s.extend({onInit:function(){},onStart:function(){},onCompleted:function(){},onCompletedAll:function(){}},e||{}),this.get_syncs()){this.reset(),this.options.onInit.call(this);var t=this,n=0,c=this.syncs.length,i=function(s){if(s.is_completed()){if(n++,t.options.onCompleted.call(t,s),n>=c)return void t.options.onCompletedAll.call(t);t.sync(n,i)}};this.sync(n,i)}},reset:function(){for(var s in this.syncs)try{this[this.syncs[s]].init()}catch(s){}},sync:function(s,e){var t=this,n=this[this.syncs[s]];t.options.onStart.call(t,n),n.sync((function(){e.call(t,n)}))},get_syncs:function(){var e=s('input[name^="lp-repair"]:checked').serializeJSON()["lp-repair"];if(!e)return!1;for(var t in e)"yes"===e[t]&&this[t=t.replace(/[-]+/g,"_")]&&this.syncs.push(t);return this.syncs},get_sync:function(s){return this[s=s.replace(/[-]+/g,"_")]},sync_course_orders:t,sync_user_orders:c,sync_user_courses:n,sync_course_final_quiz:i,sync_remove_older_data:o,sync_calculate_course_results:l},s(document).ready((function(){var e,t;e=s("#learn-press-check-all-syncs"),t=s("#learn-press-syncs").find('[name^="lp-repair"]'),e.on("click",(function(){t.prop("checked",this.checked)})),t.on("click",(function(){e.prop("checked",t.filter(":checked").length===t.length)}))})).on("click",".lp-button-repair",(function(){function e(e){return s("ul#learn-press-syncs").find('input[name*="'+e+'"]')}LP_Sync_Data.start({onInit:function(){s("ul#learn-press-syncs").children().removeClass("syncing synced"),s(".lp-button-repair").prop("disabled",!0)},onStart:function(s){e(s.id).closest("li").addClass("syncing")},onCompleted:function(s){e(s.id).closest("li").removeClass("syncing").addClass("synced")},onCompletedAll:function(){s("ul#learn-press-syncs").children().removeClass("syncing synced"),s(".lp-button-repair").prop("disabled",!1)}})}))}(jQuery);