!function(a,s,r){function n(t,e){a(window).trigger(t,e)}var t=Backbone.Router.extend({routes:{"":"start","step-:step":"step"},start:function(){this.goToStep(0)},goToStep:function(t){this.navigate("step-"+t,{trigger:!0})},step:function(t){n("thim_gs_change_step",t)},initialize:function(){Backbone.history.start()}}),e=Backbone.Model.extend({initialize:function(){console.log("Model Thim_GS_Model Initialize!")},defaults:{isRunning:!1}}),i=Backbone.View.extend({el:".thim-getting-started",router:!1,model:null,base_url_ajax:thim_gs.url_ajax,steps:thim_gs.steps,videos:[],current_step:0,events:{"click .tc-skip-step":"onSkipStep","click .tc-run-step":"onClickRunStep"},initialize:function(){var n=this;a(window).on("thim_gs_change_step",function(t,e){n.goToStep(e)}),a(window).on("thim_gs_complete",function(){n._request("finish",null).success(function(t){console.log(t)})}),a(window).on("keyup",function(t){switch(t.keyCode){case 37:n.backStep();break;case 39:n.nextStep();break;case 13:n.triggerClickRunCurrentStep()}}),this.model=new e,this.model.on("change:isRunning",this.toggleButtonSkip.bind(this)),this.router=new t,this.render(),r.complete(function(t){var e=t.action,i=t.slug,s=n.$('.thim-table-plugins tr[data-plugin="'+i+'"]');"activate"===e&&s.removeClass("processing"),1===r.count()&&(n.$(".thim-table-plugins").removeClass("running"),n.model.set("isRunning",!1),n.nextStep())}),r.success(function(t,e){var i,s;"activate"===e.action&&(i=e.slug,s=n.$('.thim-table-plugins tr[data-plugin="'+i+'"]'),t&&t.success?(s.removeClass("inactive processing").addClass("active").find(".thim-input").prop("checked",!1),s.find(".updating-message").text("Active")):(s.removeClass("processing").addClass("failed"),s.find(".updating-message").text("You can try again later :)")))}),r.error(function(t){var e,i;"activate"===t.action&&(e=t.slug,(i=n.$('.thim-table-plugins tr[data-plugin="'+e+'"]')).addClass("failed"),i.find(".updating-message").text("You can try again later :)"))})},render:function(){this.renderVideos(),this.updateHeightMain()},updateHeightMain:function(){var t=this.$(".tc-step"),e=1;t.each(function(){var t=a(this).height();e<t&&(e=t)}),this.$("main").height(e)},renderVideos:function(){var i=this;this.$(".thim-video-youtube").each(function(){var t=a(this).attr("data-video"),e=s.createPlayer({id:t});i.videos.push(e)})},pauseVideo:function(){this.videos.forEach(function(t){t.pauseVideo&&t.pauseVideo()})},onSkipStep:function(t){t.preventDefault(),this.nextStep()},toggleButtonSkip:function(){this.model&&(this.model.get("isRunning")?this.$(".tc-skip-step").hide():this.$(".tc-skip-step").show())},goToStep:function(t){t>=this.steps.length&&(t=0),this.current_step=parseInt(t),this.steps.length-1===this.current_step&&n("thim_gs_complete"),this.$(".tc-number-step .current").text(this.current_step+1),this.current_step+1===this.steps.length?this.$(".tc-skip-step").hide():this.$(".tc-skip-step").show();var e=this.$(".tc-run-step");e.removeClass("updating-message"),e.attr("disabled",!1),this.hideAllStep(),this.pauseVideo();var i=this.getKeyCurrentKeyStep();this.$(".tc-step."+i).addClass("active"),this.updateControls()},getCurrentStep:function(){var t=this.current_step;return this.steps[t]},getKeyCurrentKeyStep:function(){return this.getCurrentStep().key},hideAllStep:function(){this.$(".tc-step").removeClass("active")},triggerClickRunCurrentStep:function(){var t=this.getKeyCurrentKeyStep();this.$(".tc-step."+t).find(".tc-run-step").click()},nextStep:function(){this.current_step!==this.steps.length-1&&(this.current_step++,this.router.goToStep(this.current_step))},backStep:function(){this.current_step&&(this.current_step--,this.router.goToStep(this.current_step))},updateControls:function(){var t=this.$(".tc-controls .step");t.removeClass("active current");var s=this.current_step;t.each(function(){var t,e=a(this),i=parseInt(e.attr("data-position"));i<=s&&e.addClass("active"),i===s&&(e.addClass("current"),t=e.attr("data-step"),a(".tc-step."+t).addClass("active"))})},onClickRunStep:function(t){if(this.current_step!==this.steps.length-1){var e=a(t.target);if(e.addClass("updating-message").attr("disabled",!0),e.is("a"))window.location.href=e.attr("href");else switch(this.getKeyCurrentKeyStep()){case"quick-setup":this._request_quick_setup();break;case"install-plugins":this._request_install_plugins();break;case"updates":this._login_envato(t);break;default:this.nextStep()}}},_login_envato:function(t){a(t.target).closest("form").submit()},_request:function(t,e){var i=this.base_url_ajax+t;return a.ajax({url:i,method:"POST",data:e,dataType:"json"})},_request_quick_setup:function(){var t=this.$(".quick-setup form").serialize(),e=this;e.model.set("isRunning",!0),this._request("quick-setup",t).success(function(){e.model.set("isRunning",!1),e.nextStep()}).error(function(t){console.error(t)})},_request_install_plugins:function(){if(Thim_Core.check_active()){var s=this;this.model.set("isRunning",!0),this.$(".thim-table-plugins").addClass("running");var t=this.$(".thim-plugins input.thim-input:checked");if(!t||!t.length)return this.model.set("isRunning",!1),this.$(".thim-table-plugins").removeClass("running"),void s.nextStep();t.each(function(){var t=a(this),e=t.val(),i=t.attr("data-status");s.$('.thim-table-plugins tr[data-plugin="'+e+'"]').addClass("processing"),"not_installed"===i&&r.push({action:"install",slug:e}),r.push({action:"activate",slug:e})})}}});a(document).ready(function(){new i})}(jQuery,Thim_Video_Youtube,Thim_Plugins_Queue);